<font size="7">cmake notes</font>

-------------------------------


# Transitive Usage Requirements

```
target_compile_definitions(target PUBLIC MY_DEFINE)
target_link_libraries(     target PUBLIC my_dependency_target)
target_include_directories(target PUBLIC my_dir)


          used by target     used by target users
PRIVATE       YES                   NO
PUBLIC        YES                   YES
INTERFACE     NO                    NO


        A   <--depends-on--   B    <--depends-on--   C
PRIVATE   in A             NOT in B               NOT in C
PUBLIC    in A                 in B                   in C
INTERFACE in A                 in B               ??? in C
```

# build_config

Configuration determined build specifications may be conveniently set using the CONFIG generator expression.
```
target_compile_definitions(target PUBLIC $<$<CONFIG:Debug>:DEBUG_BUILD>)
```
The CONFIG parameter is compared case-insensitively with the configuration being built. In the presence of IMPORTED targets, the content of MAP_IMPORTED_CONFIG_DEBUG is also accounted for by this expression.

Some buildsystems generated by cmake(1) have a predetermined build-configuration set in the CMAKE_BUILD_TYPE variable.

do not use

```if ("${CMAKE_BUILD_TYPE}" STREQUAL debug)```

but, instead:

```$<$<CONFIG:Debug>:DEBUG_BUILD>```

# output artifacts

There are three kinds of output artifacts that may be build by targets as detailed in the following sections.
Their classification differs between **DLL platforms** and **non-DLL platforms**.
All Windows-based systems including Cygwin are DLL platforms.

### RUNTIME output artifacts
can be
- a .exe created by add_executable(target ...)
- on WINDOWS: a .dll created by add_executable(target SHARED ...)
destination target-props: **RUNTIME_OUTPUT_DIRECTORY** and **RUNTIME_OUTPUT_NAME**

### LIBRARY output artifacts
can be
- a .dll/.so
- a target created by add_library(target MODULE)
- on NON-WINDOWS: a .so/.dylib created by add_library(target SHARED ...)
destination target-props: **LIBRARY_OUTPUT_DIRECTORY** and **LIBRARY_OUTPUT_NAME**

### ARCHIVE output artifacts
can be
- a static lib (.lib) created by add_library(target STATIC ...)
- on WINDOWS: an **import library file** .lib of a .dll created by add_library(target SHARED ...)
- on WINDOWS: an **import library file** .lib of a .exe created by add_executable(target ...) with the ENABLE_EXPORTS target-prop on
destination target-props: **ARCHIVE_OUTPUT_DIRECTORY** and **ARCHIVE_OUTPUT_NAME**

# target_link_libraries

https://cmake.org/cmake/help/v3.10/command/target_link_libraries.html

`target_link_libraries(target target_lib)`<br>
B is a library target in the project or an imported library target.

`target_link_libraries(target "/full/path/to/B")`<br>
Do not use this.

`target_link_libraries(target plain_lib_name)`<br>
Use for system lib.

# link_flags

### link_flags using target_link_libraries()
```
target_link_libraries(target PRIVATE link_flag)
target_link_libraries(target PRIVATE "$<$<CONFIG:Debug>:-some_debug_flag>")
target_link_libraries(target PRIVATE "$<$<NOT:$<CONFIG:Debug>>:-some_release_flag>")

When link_flag starts with - (but not -l or -framework)
What about with msvc and flags that begin with / ?

These flags are subject to transitive dependencies, so let's use PRIVATE/PUBLIC accordingly.

```
### link_flags using set_property()
```
set_property(TARGET target PROPERTY LINK_FLAGS link_flag)
set_property(TARGET target PROPERTY LINK_FLAGS_DEBUG some_debug_flag)
set_property(TARGET target PROPERTY LINK_FLAGS_RELEASE some_release_flag)
```
set_property() / set_target_properties() don't support generator expressions.

Do not use set_target_properties(), it's prototype is confusing

#### Why should we consider set_property() and not always target_link_libraries() ?
Link flags specified here are inserted into the link command in the same place as the link libraries. This might not be correct, depending on the linker. Use the LINK_FLAGS target property to add link flags explicitly. The flags will then be placed at the toolchain-defined flag position in the link command.


### link_flags per build_config: debug, release
Higher granularity may be achieved for per-configuration rules by creating and linking to IMPORTED library targets.

## transitivity of linked libraries and link flags
Library dependencies are transitive. This transitive “link interface” is stored in the INTERFACE_LINK_LIBRARIES target property and may be overridden by setting the property directly.


# INTERFACE_XXXX target-props

### INTERFACE_LINK_LIBRARIES
```
populated by:
  target_link_libraries(target target_lib)
supports generator expressions
```

### INTERFACE_COMPILE_DEFINITIONS
```
populated by:
  target_compile_definitions(target PUBLIC mydef)
  target_compile_definitions(target INTERFACE mydef)
supports generator expressions
```

### INTERFACE_COMPILE_OPTIONS
```
populated by:
  target_compile_options(target PUBLIC compile_flag)
  target_compile_options(target INTERFACE compile_flag)
supports generator expressions
```

### INTERFACE_INCLUDE_DIRECTORIES
```
populated by:
  target_include_directories(target PUBLIC my_include_dir)
  target_include_directories(target INTERFACE my_include_dir)
supports generator expressions

When include directories differ between build-tree and install-tree:

target_include_directories(mylib INTERFACE
  $<BUILD_INTERFACE:${myroot}/include/mylib>  # build-tree
  $<INSTALL_INTERFACE:include/mylib>          # install-tree
)

install-tree paths MUST BE *relative* ans will be make absolute using <installation-prefix>/include/mylib

Use $<BUILD_INTERFACE:...>
- for when the target is consumed in the same build tree
- for when the target is consumed by being exported to the build tree using export()

Use $<INSTALL_INTERFACE:...>
- for when the target is consumed by being installed and exported with install(EXPORT)
```


# cmake command line

https://cmake.org/cmake/help/v3.10/manual/cmake.1.html

-D <var>:<type>=<value>
-D <var>=<value>
-G <generator-name>


## Build Tool Mode

```
cmake --build <dir> [<options>...] [-- <build-tool-options>...]

--build <dir>
Project binary directory to be built. This is required and must be first.

--target <tgt>
Build <tgt> instead of default targets. May only be specified once.

--config <cfg>
For multi-configuration tools, choose configuration <cfg>.

--clean-first
Build target clean first, then build. (To clean only, use --target clean.)

--
Pass remaining options to the native tool.

```
